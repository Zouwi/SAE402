<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game - Mixing</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Arvo&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <!-- <link rel="stylesheet" href="styleJEU2.css"> -->
  <style>
    body {
      margin: 0;
      background: url(../img/BACKGROUND/game2.jpg);
      background-repeat: no-repeat;
      background-size: 100%;
    }
    .fond {
      overflow: hidden;
      
    }

    .parent1 {
      filter: url(#goo);
      /* background-blend-mode: screen; */

      display: flex;
      width: 95%;
    }

    .parent1,
    .parent2 {
      height: 200px;
      /* border: 1px solid #ccc; */
      margin: 10px;
      padding: 10px;
    }

    .parent2 {
      width: 98%;
      display: flex;
      height: 50%;
    }

    .zone {
      background: url(./img/tube.svg);
      background-size: 100%;
      background-repeat: no-repeat;
      position: fixed;
    }

    .draggable {
      width: 100px;
      height: 50px;
      background-color: #f00;
      background-blend-mode: screen;
      color: #fff;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
      mix-blend-mode: soft-light;
    }

    .droppable {
      width: 100%;
      height: 100%;
      /* border: 1px dashed #ccc; */
      text-align: center;
      line-height: 200px;
    }

    #drop-zone {
      filter: url(#goo);
    }
  </style>
</head>

<body>
  <div class="fond">
    <div class="parent1">
      <div class="drag-element draggable" id="div1" data-target="zone1" style="background-color: aqua;"></div>
      <div class="drag-element draggable" id="div2" data-target="zone2"></div>
      <div class="drag-element draggable" id="div3" data-target="zone3"></div>
      <div class="drag-element draggable" id="div4" data-target="zone1"></div>
      <div class="drag-element draggable" id="div5" data-target="zone2"></div>
      <div class="drag-element draggable" id="div6" data-target="zone3"></div>
      <div class="drag-element draggable" id="div7" data-target="zone1" style="background-color: green;"></div>
      <div class="drag-element draggable" id="div8" data-target="zone2" style="background-color: yellow;"></div>
      <div class="drag-element draggable" id="div9" data-target="zone3" style="background-color: pink;"></div>
      <div class="drag-element draggable" id="div10" data-target="zone1" style="background-color: green;"></div>
      <div class="drag-element draggable" id="div11" data-target="zone2" style="background-color: green;"></div>
      <div class="drag-element draggable" id="div12" data-target="zone3" style="background-color: green;"></div>

    </div>


    <div class="parent2">
      <div class="zone zone1 droppable" id="zone1" data-target="div1"></div>
      <div class="zone zone2 droppable" id="zone2" data-target="div2"></div>
      <div class="zone zone3 droppable" id="zone3" data-target="div3"></div>
    </div>

    <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="goo">
          <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="20"></feGaussianBlur>
          <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0	0 1 0 0 0	0 0 1 0 0	0 0 0 26 -10" result="goo">
          </feColorMatrix>
          <!--<feBlend in2="goo" in="SourceGraphic" result="mix" ></feBlend>-->
        </filter>
      </defs>
    </svg>
  </div>
  <script>
    

    const dragElements = document.querySelectorAll('.drag-element');
    console.log(dragElements);
    let verif_fin_jeu = [];

    // Boucle à travers la liste des éléments et ajoute l'événement pour chaque élément individuellement
    dragElements.forEach(function (dragElement) {
      dragElement.addEventListener('touchstart', dragStart);

      // Initialise la position de chaque élément
      dragElement.style.transform = `translate3d(0px, 0px, 0)`;
    });

    const dropZones = document.querySelectorAll('.zone');
    console.log(dropZones);

    let isDragging = false;
    let currentX;
    let currentY;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;
    let activeElement = null;

    function dragStart(e) {
      initialX = e.touches[0].clientX - xOffset;
      initialY = e.touches[0].clientY - yOffset;

      if (e.target.classList.contains('drag-element')) {
        isDragging = true;
        activeElement = e.target;
      }
    }

    function drag(e) {
      if (isDragging && activeElement !== null) {
        e.preventDefault();

        currentX = e.touches[0].clientX - initialX;
        currentY = e.touches[0].clientY - initialY;

        xOffset = currentX;
        yOffset = currentY;

        setTranslate(currentX, currentY, activeElement);
      }
    }

    function dragEnd(e) {
      if (activeElement !== null) {
        initialX = currentX;
        initialY = currentY;

        isDragging = false;

        if (isDropped(e, activeElement)) {
          xOffset = 0;
          yOffset = 0;
          if (verif_fin_jeu.length == 6) {
            alert('Bravo, vous avez réussi !');
          }
        } else {
          xOffset = 0;
          yOffset = 0;
          setTranslate(0, 0, activeElement);
        }

        activeElement = null;
      }
    }

    function setTranslate(xPos, yPos, el) {
      el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
    }

    function isDropped(e, dragElement) {
      let isCorrectDrop = false;
      for (const dropZone of dropZones) {
        let dropZoneRect = dropZone.getBoundingClientRect();
        let dragElementRect = dragElement.getBoundingClientRect();
        console.log(dropZone.classList.contains(dragElement.dataset.target));
        if (dropZone.classList.contains(dragElement.dataset.target) &&
          dragElementRect.left >= dropZoneRect.left &&
          dragElementRect.right <= dropZoneRect.right &&
          dragElementRect.top >= dropZoneRect.top &&
          dragElementRect.bottom <= dropZoneRect.bottom) {
          isCorrectDrop = true;
          verif_fin_jeu.push(isCorrectDrop);
          return true;
        }
      }

      return false;
    }

    // Événement touchmove sur la fenêtre
    window.addEventListener('touchmove', drag);

    // Événement touchend sur l'élément draggable
    window.addEventListener('touchend', dragEnd);

    // Événement touchcancel sur l'élément draggable
    window.addEventListener('touchcancel', dragEnd);

  </script>
</body>

</html>